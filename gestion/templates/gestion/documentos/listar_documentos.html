{% extends 'gestion/base.html' %}
{% block title %}Documentación{% endblock %}
{% block content %}
<div class="container mt-4">
    <h2>Documentación / Informes</h2>
    <a href="{% url 'gestion:subir_documento' %}" class="btn btn-success mb-3">+ Subir Documento</a>

    <!-- Filtros -->
    <form method="get" class="row g-3 mb-3 align-items-end">
        <div class="col-md-4">
            <label for="empleado_id" class="form-label">Empleado</label>
            <select name="empleado_id" id="empleado_id" class="form-select">
                <option value="">Todos</option>
                {% for emp in empleados %}
                    <option value="{{ emp.id }}" {% if emp.id|stringformat:'s' == empleado_id %}selected{% endif %}>{{ emp.nombres }} {{ emp.apellidos }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label for="mes" class="form-label">Mes</label>
            <select name="mes" id="mes" class="form-select">
                <option value="">Todos</option>
                {% for m in meses %}
                    {% if m %}
                        {% with m|date:'Y-m' as mes_str %}
                        <option value="{{ mes_str }}" {% if mes == mes_str %}selected{% endif %}>{{ m|date:'F Y' }}</option>
                        {% endwith %}
                    {% endif %}
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary">Filtrar</button>
        </div>
        <div class="col-md-2">
            <a href="{% url 'gestion:listar_documentos' %}" class="btn btn-secondary">Limpiar</a>
        </div>
    </form>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>Título</th>
                <th>Empleado</th>
                <th>Fecha</th>
                <th>Archivo</th>
                <th>Reseña Admin</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for doc in documentos %}
            <tr>
                <td><a href="{% url 'gestion:detalle_documento' doc.id %}">{{ doc.titulo }}</a></td>
                <td>{{ doc.empleado.nombres }} {{ doc.empleado.apellidos }}</td>
                <td>{{ doc.fecha_subida|date:"d/m/Y H:i" }}</td>
                <td><a href="{{ doc.archivo.url }}" target="_blank">Descargar</a></td>
                <td>{% if doc.resena_admin %}<span class="text-success">{{ doc.resena_admin }}</span>{% else %}<span class="text-muted">Sin reseña</span>{% endif %}</td>
                <td>
                    <a href="{% url 'gestion:detalle_documento' doc.id %}" class="btn btn-sm btn-info">Ver</a>
                    {% if user.is_superuser %}
                    <a href="{% url 'gestion:resenar_documento' doc.id %}" class="btn btn-sm btn-warning">Reseñar</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %} 